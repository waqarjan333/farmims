<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */

class Manageprice_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();

        // Select All Query
        // $this->db->get('country')->result_array();
    }

    /*
     * Get brand by id
     */


    /*
     * Get all brand count
     */
    function get_all_pricemanage_count()
    {

        $query = $this->db->where('price_management.status!=', DELETED)
            ->get('price_management');
        return $query->num_rows();
    }

    // function province_by_country_id($id){
    //     $this->db->select('province.id, province.name as province_name');
    //     $this->db->where('status', ACTIVE);
    //     $this->db->where('country_id', $id);
    //     return $this->db->get('province')->result_array();
    // }
    /*
     * Get all brand
     */
    function get_all_pricemanage($limit, $start, $col, $dir)
    {
        $this->db->where('price_management.status!=', DELETED);
        $this->db->select('price_management.*, product.product_name, product.product_code, parties.partie_name, parties.partie_code, item_uom.name as unit_name');
        $this->db->join('product', 'product.id = price_management.product_id');
        $this->db->join('parties', 'parties.id = price_management.party_id');
        $this->db->join('item_uom', 'item_uom.id = price_management.unit');


        $query = $this->db->limit($limit, $start)->order_by($col, $dir)->get('price_management');

        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }



    function pricemanage_search($limit, $start, $search, $col, $dir)
    {

        $query = $this
            ->db
            ->where('price_management.status!=', DELETED)
            ->where(" ( price_management.price_amount LIKE '%$search%' OR price_management.unit LIKE '%$search%' ) ")
            // ->like('price_management.price_amount',$search) 
            // ->or_like('price_management.unit',$search)

            ->limit($limit, $start)
            ->order_by($col, $dir)
            ->get('price_management');


        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    function pricemanage_search_count($search)
    {
        $query = $this
            ->db
            ->where('price_management.status!=', DELETED)
            ->where(" ( price_management.price_amount LIKE '%$search%' OR price_management.unit LIKE '%$search%' ) ")
            // ->like('price_management.price_amount',$search) 
            // ->or_like('price_management.unit',$search)
            ->get('price_management');

        return $query->num_rows();
    }

    /*
     * function to add new brand
     */
    function add_priceamount($params)
    {
        $this->db->insert('price_management', $params);
        return $this->db->insert_id();
    }

    /*
     * function to update brand
     */


    function delete_priceamount($id)
    {
        $this->db
            ->where('id', $id)
            ->update('price_management', ['status' => DELETED]);
        return $this->db->affected_rows() > 0;
    }

    function get_priceamount($id){
        return $this->db->where('id',$id)
        ->get('price_management')
        ->row();
    }

    function update_priceamount($id,$params){
        $this->db->where('id',$id)
        ->update('price_management',$params);
        return $this->db->affected_rows()>0;
    }

}
