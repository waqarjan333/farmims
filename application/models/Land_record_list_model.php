<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */

class Land_record_list_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    function get_land_type_name($id)
    {

        $query = $this->db->select('land_management_data')
        ->where('status!=', DELETED)
        ->where('id=', $id)
            ->get('land_management_data');
        return $query->row_array();
    }
    function get_area_uom_name($id)
    {

        $query = $this->db->select('name')
        ->where('status!=', DELETED)
        ->where('id=', $id)
            ->get('area_uom');
        return $query->row_array();
    }

    function get_all_owned_land_count()
    {
        $this->filter_by_active_farm();
        $query = $this->db->where('status!=', DELETED)
            ->get('owned_land');
        return $query->num_rows();
    }
    
    
    

    function get_all_owned_land($limit, $start, $col, $dir)
    {
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->select('*');
        $query = $this->db->limit($limit, $start)->order_by($col, $dir)->get('owned_land');

        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }



    function owned_land_search($limit, $start, $search, $col, $dir)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( purchase_date LIKE '%$search%' OR purchase_value LIKE '%$search%' ) ")

            ->limit($limit, $start)
            ->order_by($col, $dir)
            ->get('owned_land');


        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    function owned_land_search_count($search)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( purchase_date LIKE '%$search%' OR purchase_value LIKE '%$search%' ) ")
            ->get('owned_land');

        return $query->num_rows();
    }

    function get_all_leased_land_count()
    {
        $this->filter_by_active_farm();
        $query = $this->db->where('status!=', DELETED)
            ->get('leased_land');
        return $query->num_rows();
    }
    
    
    

    function get_all_leased_land($limit, $start, $col, $dir)
    {
        // $this->db->where('status!=', DELETED);
        // $this->db->select('*');
        // $query = $this->db->limit($limit, $start)->order_by($col, $dir)->get('leased_land');
        $this->filter_by_active_farm('leased_land');
         $this->db->where('leased_land.status!=', DELETED);
        $this->db->select('leased_land.*, land_management.land_management_data AS land_type, land_managepaymeth.land_management_data AS payment_method, payentterm.land_management_data AS payment_term');
        $this->db->join('land_management_data land_management', 'land_management.id = leased_land.type_of_land_leased');
        $this->db->join('land_management_data land_managepaymeth', 'land_managepaymeth.id = leased_land.payment_method');
        $this->db->join('land_management_data payentterm', 'payentterm.id = leased_land.payment_term');
        $query = $this->db->limit($limit, $start)->order_by($col, $dir)->get('leased_land'); 
        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }



    function leased_land_search($limit, $start, $search, $col, $dir)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( contract_date LIKE '%$search%' OR contract_reg_number LIKE '%$search%' ) ")

            ->limit($limit, $start)
            ->order_by($col, $dir)
            ->get('leased_land');


        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    function leased_land_search_count($search)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( contract_date LIKE '%$search%' OR contract_reg_number LIKE '%$search%' ) ")
            ->get('leased_land');

        return $query->num_rows();
    }

    function get_all_rent_land_count()
    {
        $this->filter_by_active_farm();
        $query = $this->db->where('status!=', DELETED)
            ->get('rent_land');
        return $query->num_rows();
    }
    
    
    

    function get_all_rent_land($limit, $start, $col, $dir)
    {
        $this->db->where('status!=', DELETED);
        $this->filter_by_active_farm();
        $this->db->select('*');
        $query = $this->db->limit($limit, $start)->order_by($col, $dir)->get('rent_land');

        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }



    function rent_land_search($limit, $start, $search, $col, $dir)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( start_date LIKE '%$search%' OR rent_reg_number LIKE '%$search%' ) ")

            ->limit($limit, $start)
            ->order_by($col, $dir)
            ->get('rent_land');


        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    function rent_land_search_count($search)
    {
        $this->filter_by_active_farm();
        $query = $this
            ->db
            ->where('status!=', DELETED)
            ->where(" ( start_date LIKE '%$search%' OR rent_reg_number LIKE '%$search%' ) ")
            ->get('rent_land');

        return $query->num_rows();
    }

     function delete_leased_land($id){
         $this->filter_by_active_farm('leased_land');
         $this->filter_by_active_farm('leased_land_owner');
         $this->filter_by_active_farm('leased_land_witness');
         $this->db->where(array('id' => $id))->update('leased_land', array('status' => DELETED));
         $this->db->where(array('leased_land_id' => $id))->update('leased_land_owner', array('status' => DELETED));
        return $this->db->where(array('leased_land_id' => $id))->update('leased_land_witness', array('status' => DELETED));
    
    }

 function delete_owned_land($id){
     $this->filter_by_active_farm();
        return $this->db->where(array('id' => $id))->update('owned_land', array('status' => DELETED));
    
    }
 function delete_rent_land($id){
     $this->filter_by_active_farm('rent_land');
     $this->filter_by_active_farm('rent_land_owner');
         $this->db->where(array('id' => $id))->update('rent_land', array('status' => DELETED));
        return $this->db->where(array('rent_land_id' => $id))->update('rent_land_owner', array('status' => DELETED));
    
    }


    function get_owned_land_basic_data($landType, $id)
    {
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('id=', $id);
        $this->db->select('*');
        $query = $this->db->get('owned_land');

        if ($query->num_rows() > 0) {
            return $query->row();
        } else {
            return null;
        }
    }
    function get_owned_land_batch($landType,$id)
    {
         $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('last_form_id=', $id);
        $this->db->where('land_type=', $landType);
        $this->db->select('*');
        $query = $this->db->get('land_batch');

        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    function get_rent_land_basic_data($landType, $id){
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('id=', $id);
        $this->db->select('*');
        $query = $this->db->get('rent_land');

        if ($query->num_rows() > 0) {
            return $query->row();
        } else {
            return null;
        }
    }
    function get_rent_land_owner_data($landType, $id){
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('rent_land_id=', $id);
        $this->db->select('*');
        $query = $this->db->get('rent_land_owner');

        if ($query->num_rows() > 0) {
            return $query->row();
        } else {
            return null;
        }
    }
    function get_leased_land_basic_data($landType, $id){
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('id=', $id);
        $this->db->select('*');
        $query = $this->db->get('leased_land');

        if ($query->num_rows() > 0) {
            return $query->row();
        } else {
            return null;
        }
    }
    function get_leased_land_owner_data($landType, $id){
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('leased_land_id=', $id);
        $this->db->select('*');
        $query = $this->db->get('leased_land_owner');

        if ($query->num_rows() > 0) {
            return $query->row();
        } else {
            return null;
        }
    }
    function get_leased_land_witness_data($landType, $id){
        $this->filter_by_active_farm();
        $this->db->where('status!=', DELETED);
        $this->db->where('leased_land_id=', $id);
        $this->db->select('*');
        $query = $this->db->get('leased_land_witness');

        if ($query->num_rows() > 0) {
            return $query->result();
        } else {
            return null;
        }
    }

    public function update_ownedform($id,$params)
{
    $this->filter_by_active_farm();
      $this->db->where('id', $id);
        return $this->db->update('owned_land', $params);
}

    public function update_rentform($id,$params,$params2)
{
    $this->filter_by_active_farm('rent_land');
      $this->db->where('id', $id);
     $this->db->update('rent_land', $params);

     $this->filter_by_active_farm('rent_land_owner');
     $this->db->where('rent_land_id', $id);
      return $this->db->update('rent_land_owner', $params2);
}

    public function update_leasedform($id,$params,$params2)
{
    $this->filter_by_active_farm('leased_land');
      $this->db->where('id', $id);
     $this->db->update('leased_land', $params);

     $this->filter_by_active_farm('leased_land_owner');
     $this->db->where('leased_land_id', $id);
     return $this->db->update('leased_land_owner', $params2);

    
}
    public function delete_batch($batch,$formID,$FormType)
    {
        $this->db->where('last_form_id', $formID);
        $this->db->where('batch_no', $batch);
        $this->db->where('land_type', $FormType);
       return $this->db->delete('land_batch'); 
    }
     public function delete_area($batch,$formID,$FormType,$area)
    {
        $this->db->where('last_form_id', $formID);
        $this->db->where('batch_no', $batch);
        $this->db->where('area_no', $area);
        $this->db->where('land_type', $FormType);
       return $this->db->delete('land_batch'); 
    }
        public function update_areauom($batch,$formID,$formType,$area,$params)
{
        $this->db->where('last_form_id', $formID);
        $this->db->where('batch_no', $batch);
        $this->db->where('area_no', $area);
        $this->db->where('land_type', $formType);
     return $this->db->update('land_batch', $params);

    
}
}
