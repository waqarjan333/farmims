<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */

class Bulk_weight extends Admin_Controller
{

    function __construct()
    {
        parent::__construct();
        $this->load->model('Bulkweight_model');
    }

    function index()
    {
        
        $data['batchs'] = $this->Bulkweight_model->get_batch_for_dd();
        $data['_view'] = 'fattening_animals/bulk_weight';
        $this->load->view('layouts/main', $data);
    }

    function get_batch_animals_weight($batch_no)
    {
        $data = $this->Bulkweight_model->get_animals_with_weight($batch_no);
        
        $table_body="";
        $count=1;
        foreach ($data as $value) {
            $array = json_decode(json_encode($value), true);
            //echo "<pre>"; print_r($array); 
            for ($i=1; $i < count($array); $i++) { 
                $last_weight = $this->Bulkweight_model->get_last_weight($array['id']);
                $table_body = "<tr>";
                $table_body .= "<td>".$count."<input type='hidden' class='form-control' value='".$array['id']."' name='animal_id[]' /></td>";
                $table_body .= "<td>".$array['code']."</td>";
                $table_body .= "<td>".$array['name']."</td>";
                $table_body .= "<td>".$array['weight']."</td>";
                $table_body .= "<td>".$last_weight->weight."</td>";
                $table_body .= "<td>".$last_weight->date."</td>";
                $table_body .= "<td><input type='text' class='form-control' name='today_weight[]' /></td>";
                $table_body .= "<td>".date('Y-m-d')."</td>";
                $table_body .= "</tr>";
            }
            $count++;
            echo $table_body; 
        }
        
        
    }

    function update_bulk_weight(){
        $animals_id = $this->input->post('animal_id');
        $today_weight = $this->input->post('today_weight');
        for ($i=0; $i < count($animals_id); $i++) {
            $params = array(
                        'animal_id' => $animals_id[$i],
                        'weight' => $today_weight[$i],
                        'created_by' => $this->session->userdata('id'),
                        'date' => date('Y-m-d'),
                        'farm_id' => $this->session->userdata('active_farm')
        
                    );
            $this->db->insert('fattening_animal_weight_history', $params);
        }
        $this->session->set_flashdata('success', 'Bulk Weight added successfuly');
        redirect('bulk_weight');
    }

    
}
